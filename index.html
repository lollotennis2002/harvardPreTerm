<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Harvard PreTerm — Sheet Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 24px; }
    h1 { margin: 0 0 12px; font-size: 20px; }
    #updated { color: #555; font-size: 12px; margin-bottom: 12px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #ddd; padding: 8px; vertical-align: top; }
    th { background: #f6f6f6; text-align: left; }
  </style>
</head>
<body>
  <h1>Harvard PreTerm — Live Google Sheet</h1>
  <div id="updated">Loading…</div>
  <div id="table-container">Fetching data…</div>

  <script>
    const CSV_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vSeZUFXzPOw4jI4lsbE8tYhySh1CBK-xeIhDAe6E5ZkAZYHCn2NrseRdzX6DZcwPZGLy6hU6ENAEfQ3/pub?gid=31153433&single=true&output=csv";

    function fetchCsv() {
      const url = CSV_URL + "&_t=" + Date.now(); // cache-buster
      fetch(url, { cache: "no-store" })
        .then(r => {
          if (!r.ok) throw new Error("HTTP " + r.status);
          return r.text();
        })
        .then(renderTable)
        .catch(err => {
          console.error("Load error:", err);
          document.getElementById("table-container").textContent = "Error loading data.";
        });
    }

    function parseCsv(text) {
      // Basic CSV parser that handles quoted commas/newlines
      const rows = [];
      let row = [], cell = "", inQuotes = false;
      for (let i = 0; i < text.length; i++) {
        const ch = text[i], next = text[i + 1];
        if (inQuotes) {
          if (ch === '"' && next === '"') { cell += '"'; i++; }
          else if (ch === '"') { inQuotes = false; }
          else { cell += ch; }
        } else {
          if (ch === '"') inQuotes = true;
          else if (ch === ',') { row.push(cell); cell = ""; }
          else if (ch === '\n') { row.push(cell); rows.push(row); row = []; cell = ""; }
          else { cell += ch; }
        }
      }
      if (cell.length || row.length) { row.push(cell); rows.push(row); }
      return rows;
    }

    function renderTable(csvText) {
      const rows = parseCsv(csvText);
      if (!rows.length) {
        document.getElementById("table-container").textContent = "No data.";
        return;
      }
      let html = "<table>";
      rows.forEach((r, i) => {
        html += "<tr>";
        r.forEach(cell => {
          html += i === 0 ? `<th>${cell}</th>` : `<td>${cell}</td>`;
        });
        html += "</tr>";
      });
      html += "</table>";
      document.getElementById("table-container").innerHTML = html;
      document.getElementById("updated").textContent = "Last updated: " + new Date().toLocaleString();
    }

    fetchCsv();
    // auto-refresh every 60s
    setInterval(fetchCsv, 60000);
  </script>
</body>
</html>
